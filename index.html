<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Firebase PSC</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        button, input { padding: 10px; margin: 5px 0; width: 100%; }
        .premium { color: green; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Test Firebase PSC</h1>

    <!-- Panel logowania -->
    <div id="auth-section">
        <h2>Logowanie</h2>
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Has≈Ço">
        <button onclick="login()">Zaloguj</button>
        <button onclick="register()">Zarejestruj</button>
    </div>

    <!-- Panel u≈ºytkownika -->
    <div id="user-section" style="display: none;">
        <h2>Witaj, <span id="user-email"></span>!</h2>
        <p>Status: <span id="premium-status">NIE PREMIUM</span></p>
        
        <h3>Aktywuj Premium (PSC)</h3>
        <input type="text" id="psc-code" placeholder="Wpisz 16-cyfrowy kod">
        <button onclick="activatePSC()">Wy≈õlij kod</button>
        
        <button onclick="logout()">Wyloguj</button>
    </div>

    <script>
        // üî• Konfiguracja Firebase (u≈ºyj SWOICH danych z Firebase Console!)
        const firebaseConfig = {
            apiKey: "AIzaSyDECwBnJzGnD8oo4ttRPUNkYYzRMO4Euno",
            authDomain: "psc2025-ee3b5.firebaseapp.com",
            projectId: "psc2025-ee3b5",
            storageBucket: "psc2025-ee3b5.appspot.com",
            messagingSenderId: "990291382716",
            appId: "1:990291382716:web:964df65b498ba7e61a9bb9"
        };

        // Inicjalizacja Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Obs≈Çuga logowania/rejestracji
        function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            auth.signInWithEmailAndPassword(email, password)
                .then(() => alert("Zalogowano!"))
                .catch(err => alert("B≈ÇƒÖd: " + err.message));
        }

        function register() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            auth.createUserWithEmailAndPassword(email, password)
                .then(() => alert("Konto stworzone!"))
                .catch(err => alert("B≈ÇƒÖd: " + err.message));
        }

        function logout() {
            auth.signOut();
        }

        // Wysy≈Çanie kodu PSC
        function activatePSC() {
            const code = document.getElementById('psc-code').value;
            const user = auth.currentUser;
            
            if (!user) {
                alert("Najpierw siƒô zaloguj!");
                return;
            }
            
            if (code.length !== 16) {
                alert("Kod musi mieƒá 16 cyfr!");
                return;
            }

            // Zapisz kod w Firestore
            db.collection("pscCodes").add({
                userId: user.uid,
                code: code,
                status: "pending",
                date: new Date()
            }).then(() => alert("Kod wys≈Çany! Administrator zweryfikuje go wkr√≥tce."));
        }

        // Sprawdzanie statusu premium
        function checkPremium() {
            const user = auth.currentUser;
            if (!user) return;
            
            db.collection("premiumUsers").doc(user.uid).get()
                .then(doc => {
                    const isPremium = doc.exists && doc.data().premium;
                    document.getElementById('premium-status').textContent = isPremium ? "PREMIUM" : "NIE PREMIUM";
                    document.getElementById('premium-status').className = isPremium ? "premium" : "";
                });
        }

        // Obs≈Çuga zmian stanu u≈ºytkownika
        auth.onAuthStateChanged(user => {
            const authSection = document.getElementById('auth-section');
            const userSection = document.getElementById('user-section');
            
            if (user) {
                authSection.style.display = "none";
                userSection.style.display = "block";
                document.getElementById('user-email').textContent = user.email;
                checkPremium();
                // Sprawdzaj co 5 sekund, czy admin nada≈Ç premium
                setInterval(checkPremium, 5000);
            } else {
                authSection.style.display = "block";
                userSection.style.display = "none";
            }
        });
    </script>
</body>
</html>